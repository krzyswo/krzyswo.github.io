<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Kalkulator zarobk√≥w z historiƒÖ</title>
    <style>
        * { box-sizing: border-box; }
        html, body {
            padding: 20px;
            display: flex;
            flex-wrap: nowrap;
            justify-content: flex-start;
            align-items: flex-start;
            gap: 40px;
        }
        body {
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
        }
        .container {
            flex: 1;
            min-width: 400px;
            max-width: 600px;
        }
        .history {
            flex: 1;
            min-width: 400px;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border-left: 2px solid #ddd;
            padding-left: 15px;
            transition: all 0.3s ease;
        }
        input, button, textarea {
            padding: 10px;
            font-size: 16px;
            margin-top: 5px;
            width: 100%;
        }
        .wynik {
            margin-top: 20px;
            font-size: 24px;
            font-weight: bold;
        }
        .green { background-color: green; color: white; }
        .gold { background-color: gold; color: black; }
        .red { background-color: red; color: white; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 5px;
            text-align: center;
        }
        th { background-color: #f4f4f4; }
        .checkbox-container {
            font-size: 14px;
            margin-top: 5px;
        }
        .delete-btn {
            color: red;
            cursor: pointer;
            font-weight: bold;
        }
            .session {
            flex: 1;
            min-width: 300px;
            max-width: 400px;
            margin-right: 20px;
        }
</style>
</head>
<body>
    <div class="session">
        <h2>Opis sesji</h2>
        <textarea id="description" rows="3" placeholder="Co robi≈Çe≈õ podczas tej sesji?"></textarea>
    </div>

    <div class="container">
        <h2>Kalkulator miesiƒôczny</h2>
        <input type="number" id="wyplata" placeholder="Wyp≈Çata miesiƒôczna w z≈Ç">
        <button id="startMonthly" class="green">Start licznika</button>
        <button id="stopMonthly" class="red">Stop licznika</button>
        <div class="checkbox-container">
            <label><input type="checkbox" id="suppressConfirm"> Nie pokazuj ponownie ostrze≈ºenia przy ponownym uruchomieniu licznika miesiƒôcznego</label>
        </div>
        <div class="wynik" id="wynikMonthly">Zarobi≈Çe≈õ: 0 z≈Ç</div>

        <hr>

        <h2>Kalkulator godzinowy</h2>
        <input type="number" id="stawkaGodzinowa" placeholder="Stawka godzinowa w z≈Ç">
        <button id="startHourly" class="green">Start licznika</button>
        <button id="stopHourly" class="red">Stop licznika</button>
        <div class="checkbox-container">
            <label><input type="checkbox" id="suppressConfirmHourly"> Nie pokazuj ponownie ostrze≈ºenia przy ponownym uruchomieniu licznika godzinowego</label>
        </div>
        <div class="wynik" id="wynikHourly">Zarobi≈Çe≈õ: 0 z≈Ç</div>
    </div>

    <div class="history" id="historySection">
        <button id="toggleHistory" class="green" style="margin-bottom: 10px;">Ukryj historiƒô</button>
        <h3>Historia zarobk√≥w</h3>
        <table id="historyTable">
            <thead>
                <tr>
                    <th>Typ</th>
                    <th>Start</th>
                    <th>Stop</th>
                    <th>Zarobek (z≈Ç)</th>
                    <th>Opis</th>
                    <th>Usu≈Ñ</th>
                </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
                <tr>
                    <td colspan="4"><strong>SUMA:</strong></td>
                    <td colspan="2" id="totalEarnings">0.00 z≈Ç</td>
                </tr>
            </tfoot>
        </table>
        <button onclick="clearHistory()" class="red">Wyczy≈õƒá historiƒô</button>
        <button onclick="exportCSV()" class="green">Eksportuj do CSV</button>
    </div>

    <script>
        let monthlyTimer, hourlyTimer, monthlyStart, hourlyStart;
        let monthlyRate, hourlyRate;

        let history = JSON.parse(localStorage.getItem('earningHistory')) || [];
        const suppressConfirm = localStorage.getItem('suppressConfirm') === 'true';
        const suppressConfirmHourly = localStorage.getItem('suppressConfirmHourly') === 'true';

        document.getElementById('suppressConfirm').checked = suppressConfirm;
        document.getElementById('suppressConfirmHourly').checked = suppressConfirmHourly;

        document.getElementById('suppressConfirm').addEventListener('change', function () {
            localStorage.setItem('suppressConfirm', this.checked);
        });
        document.getElementById('suppressConfirmHourly').addEventListener('change', function () {
            localStorage.setItem('suppressConfirmHourly', this.checked);
        });

        function confirmRestart(type = 'monthly') {
            const key = type === 'hourly' ? 'suppressConfirmHourly' : 'suppressConfirm';
            if (localStorage.getItem(key) === 'true') return true;
            return confirm('Czy na pewno chcesz zrestartowaƒá licznik ' + (type === 'hourly' ? 'godzinowy' : 'miesiƒôczny') + '?');
        }

        document.getElementById('startMonthly').onclick = function() {
            if (monthlyStart && !confirmRestart('monthly')) return;
            clearInterval(monthlyTimer);
            const wyplata = parseFloat(document.getElementById('wyplata').value);
            if (!wyplata || wyplata <= 0) return alert('Podaj poprawnƒÖ wyp≈Çatƒô miesiƒôcznƒÖ.');
            monthlyRate = wyplata / (160 * 3600);
            monthlyStart = Date.now();
            monthlyTimer = setInterval(() => updateWynik('wynikMonthly', monthlyRate, monthlyStart), 1000);
            this.classList.replace('green', 'gold');
        };

        document.getElementById('stopMonthly').onclick = function() {
            if (!monthlyStart) return;
            clearInterval(monthlyTimer);
            const elapsed = (Date.now() - monthlyStart) / 1000;
            const zarobek = monthlyRate * elapsed;
            saveHistory('Miesiƒôczny', monthlyStart, Date.now(), zarobek);
            monthlyStart = null;
            document.getElementById('startMonthly').classList.replace('gold', 'green');
        };

        document.getElementById('startHourly').onclick = function() {
            if (hourlyStart && !confirmRestart('hourly')) return;
            clearInterval(hourlyTimer);
            const stawka = parseFloat(document.getElementById('stawkaGodzinowa').value);
            if (!stawka || stawka <= 0) return alert('Podaj poprawnƒÖ stawkƒô godzinowƒÖ.');
            hourlyRate = stawka / 3600;
            hourlyStart = Date.now();
            hourlyTimer = setInterval(() => updateWynik('wynikHourly', hourlyRate, hourlyStart), 1000);
            this.classList.replace('green', 'gold');
        };

        document.getElementById('stopHourly').onclick = function() {
            if (!hourlyStart) return;
            clearInterval(hourlyTimer);
            const elapsed = (Date.now() - hourlyStart) / 1000;
            const zarobek = hourlyRate * elapsed;
            saveHistory('Godzinowy', hourlyStart, Date.now(), zarobek);
            hourlyStart = null;
            document.getElementById('startHourly').classList.replace('gold', 'green');
        };

        function updateWynik(id, rate, start) {
            const elapsed = (Date.now() - start) / 1000;
            document.getElementById(id).innerText = `Zarobi≈Çe≈õ: ${(rate * elapsed).toFixed(2)} z≈Ç`;
        }

        function saveHistory(type, start, stop, earned) {
            const desc = document.getElementById('description').value;
            const entry = {
                id: Date.now(),
                type,
                start: new Date(start).toLocaleString(),
                stop: new Date(stop).toLocaleString(),
                earned: earned.toFixed(2),
                description: desc
            };
            history.push(entry);
            localStorage.setItem('earningHistory', JSON.stringify(history));
            renderHistory();
        }

        function deleteEntry(id) {
            history = history.filter(e => e.id !== id);
            localStorage.setItem('earningHistory', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            const tbody = document.getElementById('historyTable').querySelector('tbody');
            tbody.innerHTML = '';
            let total = 0;
            history.forEach(entry => {
                total += parseFloat(entry.earned);
                tbody.innerHTML += `
                    <tr>
                        <td>${entry.type}</td>
                        <td>${entry.start}</td>
                        <td>${entry.stop}</td>
                        <td>${entry.earned}</td>
                        <td>${entry.description}</td>
                        <td><span class="delete-btn" onclick="deleteEntry(${entry.id})">üóëÔ∏è</span></td>
                    </tr>`;
            });
            document.getElementById('totalEarnings').innerText = total.toFixed(2) + ' z≈Ç';
        }

        function clearHistory() {
            if (confirm('Czy na pewno chcesz wyczy≈õciƒá ca≈ÇƒÖ historiƒô?')) {
                localStorage.removeItem('earningHistory');
                history.length = 0;
                renderHistory();
            }
        }

        function exportCSV() {
            let csv = 'Typ,Start,Stop,Zarobek (z≈Ç),Opis\n';
            history.forEach(entry => {
                csv += `${entry.type},${entry.start},${entry.stop},${entry.earned},"${entry.description.replace(/"/g, '""')}"\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'historia_zarobkow.csv';
            link.click();
        }

        const section = document.getElementById('historySection');
        const toggleBtn = document.getElementById('toggleHistory');
        const historyToggleState = localStorage.getItem('historySectionHidden') === 'true';

        if (historyToggleState) {
            section.style.display = 'none';
            toggleBtn.innerText = 'Poka≈º historiƒô';
        }

        toggleBtn.addEventListener('click', function() {
            if (section.style.display === 'none') {
                section.style.display = '';
                this.innerText = 'Ukryj historiƒô';
                localStorage.setItem('historySectionHidden', 'false');
            } else {
                section.style.display = 'none';
                this.innerText = 'Poka≈º historiƒô';
                localStorage.setItem('historySectionHidden', 'true');
            }
        });
    </script>
</body>
</html>
